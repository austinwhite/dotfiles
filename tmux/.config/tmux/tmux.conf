# plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'

# change pane and index start indexes to 1 (default 0)
set -g base-index 1
set -g pane-base-index 1

is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l

# set prefix
unbind-key C-b
set-option -g prefix C-Space
bind-key C-Space send-prefix

# upgrade $TERM
set-option -sa terminal-overrides ",xterm-256color:RGB:smcup@:rmcup@"
set-option -g default-terminal "screen-256color"
set -g mouse on

# clear buffer passthrouh
bind C-l send-keys 'C-l'

# reload config file
bind r source-file $XDG_CONFIG_HOME/tmux/tmux.conf

# colors: vim-github-dark
# "base0"        : ["#0d1117", 233],
# "base1"        : ["#161b22", 235],
# "base2"        : ["#21262d", 237],
# "base3"        : ["#89929b", 243],
# "base4"        : ["#c6cdd5", 249],
# "base5"        : ["#ecf2f8", 252],
# "red"          : ["#fa7970", 210],
# "orange"       : ["#faa356", 178],
# "green"        : ["#7ce38b", 114],
# "lightblue"    : ["#a2d2fb", 153],
# "blue"         : ["#77bdfb", 75],
# "purp"         : ["#cea5fb", 183],

# theme
# status bar
set -g status on
set -g status-interval 1
set -g status-justify left
set -g status-style 'bg=default,fg=#c6cdd5'

# status left
set -g status-left-length 60
set -g status-left-style default
set -g status-left "#[fg=#cea5fb] Session #[fg=#77bdfb,bold]#{session_name}#[fg=#cea5fb]   #[fg=#77bdfb] "

# status right
set -g status-right-length 50
set -g status-right-style default
set -g status-right "#{?client_prefix,#[fg=#77bdfb]#[fg=default] ,}"

# windows and panes and messages
set -g pane-active-border-style "fg=#7ce38b,bg=default"
set -g pane-border-style "fg=brightblack,bg=default"
set-window-option -g window-status-current-style fg="#7ce38b",bg=default

set-window-option -g mode-keys vi

bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# open panes in cwd
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

run '/opt/homebrew/opt/tpm/share/tpm/tpm'
